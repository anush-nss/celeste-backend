openapi: 3.1.0
info:
  title: Celeste API
  description: API documentation for the Celeste e-commerce platform.
  version: 1.0.0
servers:
  - url: http://localhost:3000
    description: Local Development Server
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Auth:
      type: object
      properties:
        accessToken:
          type: string
          description: JWT access token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
    UserRegistration:
      type: object
      required:
        - email
        - password
        - firstName
        - lastName
      properties:
        email:
          type: string
          format: email
          example: user@example.com
        password:
          type: string
          format: password
          example: StrongPassword123
        firstName:
          type: string
          example: John
        lastName:
          type: string
          example: Doe
        phoneNumber:
          type: string
          example: '+15551234567'
        address:
          type: string
          example: '123 Main St, Anytown, USA'
    Product:
      type: object
      properties:
        id:
          type: string
          example: prod_123
        name:
          type: string
          example: 'Wireless Bluetooth Headphones'
        description:
          type: string
          example: 'High-quality over-ear headphones with noise cancellation.'
        price:
          type: number
          format: float
          example: 99.99
        category:
          type: string
          example: 'Electronics'
        imageUrl:
          type: string
          example: 'https://example.com/headphones.jpg'
        stock:
          type: number
          format: integer
          example: 150
        brand:
          type: string
          example: 'AudioTech'
        rating:
          type: number
          format: float
          example: 4.5
        reviews:
          type: number
          format: integer
          example: 230
        isFeatured:
          type: boolean
          example: true
    Category:
      type: object
      properties:
        id:
          type: string
          example: cat_456
        name:
          type: string
          example: 'Electronics'
        description:
          type: string
          example: 'Devices and gadgets for modern living.'
        imageUrl:
          type: string
          example: 'https://example.com/electronics.jpg'
        parentCategoryId:
          type: string
          nullable: true
          example: null
    Discount:
      type: object
      properties:
        id:
          type: string
          example: disc_789
        name:
          type: string
          example: 'Summer Sale'
        description:
          type: string
          example: '20% off all electronics.'
        type:
          type: string
          enum: [PERCENTAGE, FLAT]
          example: PERCENTAGE
        value:
          type: number
          format: float
          example: 20
        validFrom:
          type: string
          format: date-time
          example: '2024-06-01T00:00:00Z'
        validTo:
          type: string
          format: date-time
          example: '2024-08-31T23:59:59Z'
        applicableProducts:
          type: array
          items:
            type: string
          example: ['prod_123', 'prod_456']
        applicableCategories:
          type: array
          items:
            type: string
          example: ['cat_456']
    OrderItem:
      type: object
      properties:
        productId:
          type: string
          example: prod_123
        name:
          type: string
          example: 'Wireless Bluetooth Headphones'
        price:
          type: number
          format: float
          example: 99.99
        quantity:
          type: number
          format: integer
          example: 1
    Order:
      type: object
      properties:
        id:
          type: string
          example: order_001
        userId:
          type: string
          example: user_abc
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        totalAmount:
          type: number
          format: float
          example: 99.99
        discountApplied:
          type: string
          nullable: true
          example: disc_789
        promotionApplied:
          type: string
          nullable: true
          example: null
        status:
          type: string
          enum: [pending, processing, shipped, delivered, cancelled]
          example: pending
        createdAt:
          type: string
          format: date-time
          example: '2024-07-25T10:00:00Z'
        updatedAt:
          type: string
          format: date-time
          example: '2024-07-25T10:00:00Z'
security:
  - bearerAuth: []
paths:
  /auth/register:
    post:
      summary: Register a new user
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegistration'
            example:
              email: newuser@example.com
              password: SecurePassword123
              firstName: Jane
              lastName: Doe
              phoneNumber: '+1234567890'
              address: '456 Oak Ave, Townsville, USA'
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Auth'
        '400':
          description: Invalid input
  /products:
    get:
      summary: Get all products
      tags:
        - Products
      parameters:
        - in: query
          name: category
          schema:
            type: string
          description: Filter by product category
          example: Electronics
        - in: query
          name: minPrice
          schema:
            type: number
          description: Filter by minimum price
          example: 50
        - in: query
          name: maxPrice
          schema:
            type: number
          description: Filter by maximum price
          example: 200
        - in: query
          name: isFeatured
          schema:
            type: boolean
          description: Filter by featured products
          example: true
      responses:
        '200':
          description: A list of products
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'
              example:
                - id: prod_123
                  name: 'Wireless Bluetooth Headphones'
                  description: 'High-quality over-ear headphones with noise cancellation.'
                  price: 99.99
                  category: 'Electronics'
                  imageUrl: 'https://example.com/headphones.jpg'
                  stock: 150
                  brand: 'AudioTech'
                  rating: 4.5
                  reviews: 230
                  isFeatured: true
                - id: prod_456
                  name: 'Smartwatch'
                  description: 'Fitness tracker with heart rate monitor.'
                  price: 149.99
                  category: 'Wearables'
                  imageUrl: 'https://example.com/smartwatch.jpg'
                  stock: 80
                  brand: 'WearFit'
                  rating: 4.2
                  reviews: 150
                  isFeatured: false
    post:
      summary: Create a new product
      tags:
        - Products
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Product'
            example:
              name: 'New Product'
              description: 'Description of the new product.'
              price: 29.99
              category: 'Books'
              imageUrl: 'https://example.com/new_product.jpg'
              stock: 100
              brand: 'BrandX'
              rating: 0
              reviews: 0
              isFeatured: false
      responses:
        '201':
          description: Product created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '400':
          description: Invalid input
  /products/{id}:
    get:
      summary: Get a product by ID
      tags:
        - Products
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the product to retrieve
          example: prod_123
      responses:
        '200':
          description: Product details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
              example:
                id: prod_123
                name: 'Wireless Bluetooth Headphones'
                description: 'High-quality over-ear headphones with noise cancellation.'
                price: 99.99
                category: 'Electronics'
                imageUrl: 'https://example.com/headphones.jpg'
                stock: 150
                brand: 'AudioTech'
                rating: 4.5
                reviews: 230
                isFeatured: true
        '404':
          description: Product not found
    put:
      summary: Update a product
      tags:
        - Products
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the product to update
          example: prod_123
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Product'
            example:
              price: 89.99
              stock: 120
      responses:
        '200':
          description: Product updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '400':
          description: Invalid input
        '404':
          description: Product not found
    delete:
      summary: Delete a product
      tags:
        - Products
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the product to delete
          example: prod_123
      responses:
        '204':
          description: Product deleted successfully
        '404':
          description: Product not found
  /categories:
    get:
      summary: Get all categories
      tags:
        - Categories
      responses:
        '200':
          description: A list of categories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'
              example:
                - id: cat_456
                  name: 'Electronics'
                  description: 'Devices and gadgets for modern living.'
                  imageUrl: 'https://example.com/electronics.jpg'
                  parentCategoryId: null
                - id: cat_789
                  name: 'Books'
                  description: 'Fiction and non-fiction books.'
                  imageUrl: 'https://example.com/books.jpg'
                  parentCategoryId: null
    post:
      summary: Create a new category
      tags:
        - Categories
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Category'
            example:
              name: 'New Category'
              description: 'Description for the new category.'
              imageUrl: 'https://example.com/new_category.jpg'
              parentCategoryId: null
      responses:
        '201':
          description: Category created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '400':
          description: Invalid input
  /categories/{id}:
    get:
      summary: Get a category by ID
      tags:
        - Categories
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the category to retrieve
          example: cat_456
      responses:
        '200':
          description: Category details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
              example:
                id: cat_456
                name: 'Electronics'
                description: 'Devices and gadgets for modern living.'
                imageUrl: 'https://example.com/electronics.jpg'
                parentCategoryId: null
        '404':
          description: Category not found
    put:
      summary: Update a category
      tags:
        - Categories
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the category to update
          example: cat_456
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Category'
            example:
              description: 'Updated description for electronics.'
      responses:
        '200':
          description: Category updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '400':
          description: Invalid input
        '404':
          description: Category not found
    delete:
      summary: Delete a category
      tags:
        - Categories
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the category to delete
          example: cat_456
      responses:
        '204':
          description: Category deleted successfully
        '404':
          description: Category not found
  /discounts:
    get:
      summary: Get all discounts
      tags:
        - Discounts
      parameters:
        - in: query
          name: availableOnly
          schema:
            type: boolean
          description: Filter for currently available discounts
          example: true
        - in: query
          name: populateReferences
          schema:
            type: boolean
          description: Populate product and category references
          example: false
      responses:
        '200':
          description: A list of discounts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Discount'
              example:
                - id: disc_789
                  name: 'Summer Sale'
                  description: '20% off all electronics.'
                  type: PERCENTAGE
                  value: 20
                  validFrom: '2024-06-01T00:00:00Z'
                  validTo: '2024-08-31T23:59:59Z'
                  applicableProducts: ['prod_123']
                  applicableCategories: ['cat_456']
                - id: disc_101
                  name: 'Holiday Special'
                  description: 'Flat $10 off on orders over $50.'
                  type: FLAT
                  value: 10
                  validFrom: '2024-12-01T00:00:00Z'
                  validTo: '2024-12-31T23:59:59Z'
                  applicableProducts: []
                  applicableCategories: []
    post:
      summary: Create a new discount
      tags:
        - Discounts
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Discount'
            example:
              name: 'New Year Discount'
              description: '15% off on all items.'
              type: PERCENTAGE
              value: 15
              validFrom: '2025-01-01T00:00:00Z'
              validTo: '2525-01-31T23:59:59Z'
              applicableProducts: []
              applicableCategories: []
      responses:
        '201':
          description: Discount created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Discount'
        '400':
          description: Invalid input
  /discounts/{id}:
    get:
      summary: Get a discount by ID
      tags:
        - Discounts
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the discount to retrieve
          example: disc_789
      responses:
        '200':
          description: Discount details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Discount'
              example:
                id: disc_789
                name: 'Summer Sale'
                description: '20% off all electronics.'
                type: PERCENTAGE
                value: 20
                validFrom: '2024-06-01T00:00:00Z'
                validTo: '2024-08-31T23:59:59Z'
                applicableProducts: ['prod_123']
                applicableCategories: ['cat_456']
        '404':
          description: Discount not found
    put:
      summary: Update a discount
      tags:
        - Discounts
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the discount to update
          example: disc_789
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Discount'
            example:
              value: 25
              description: '25% off all electronics.'
      responses:
        '200':
          description: Discount updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Discount'
        '400':
          description: Invalid input
        '404':
          description: Discount not found
    delete:
      summary: Delete a discount
      tags:
        - Discounts
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the discount to delete
          example: disc_789
      responses:
        '204':
          description: Discount deleted successfully
        '404':
          description: Discount not found
  /orders:
    get:
      summary: Get all orders for the authenticated user
      tags:
        - Orders
      security:
        - bearerAuth: []
      responses:
        '200':
          description: A list of orders
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Order'
              example:
                - id: order_001
                  userId: user_abc
                  items:
                    - productId: prod_123
                      name: 'Wireless Bluetooth Headphones'
                      price: 99.99
                      quantity: 1
                  totalAmount: 99.99
                  discountApplied: null
                  promotionApplied: null
                  status: pending
                  createdAt: '2024-07-25T10:00:00Z'
                  updatedAt: '2024-07-25T10:00:00Z'
                - id: order_002
                  userId: user_abc
                  items:
                    - productId: prod_456
                      name: 'Smartwatch'
                      price: 149.99
                      quantity: 1
                  totalAmount: 149.99
                  discountApplied: null
                  promotionApplied: null
                  status: shipped
                  createdAt: '2024-07-20T15:30:00Z'
                  updatedAt: '2024-07-22T09:00:00Z'
    post:
      summary: Create a new order
      tags:
        - Orders
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
                  example: user_abc
                items:
                  type: array
                  items:
                    $ref: '#/components/schemas/OrderItem'
                totalAmount:
                  type: number
                  format: float
                  example: 99.99
                discountApplied:
                  type: string
                  nullable: true
                  example: null
                promotionApplied:
                  type: string
                  nullable: true
                  example: null
                status:
                  type: string
                  enum: [pending, processing, shipped, delivered, cancelled]
                  example: pending
              required:
                - userId
                - items
                - totalAmount
                - status
            example:
              userId: user_xyz
              items:
                - productId: prod_789
                  name: 'Gaming Mouse'
                  price: 49.99
                  quantity: 2
              totalAmount: 99.98
              discountApplied: null
              promotionApplied: null
              status: pending
      responses:
        '201':
          description: Order created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Invalid input
  /orders/{id}:
    get:
      summary: Get an order by ID
      tags:
        - Orders
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the order to retrieve
          example: order_001
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
              example:
                id: order_001
                userId: user_abc
                items:
                  - productId: prod_123
                    name: 'Wireless Bluetooth Headphones'
                    price: 99.99
                    quantity: 1
                totalAmount: 99.99
                discountApplied: null
                promotionApplied: null
                status: pending
                createdAt: '2024-07-25T10:00:00Z'
                updatedAt: '2024-07-25T10:00:00Z'
        '404':
          description: Order not found
    put:
      summary: Update an order (Admin only)
      tags:
        - Orders
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the order to update
          example: order_001
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [pending, processing, shipped, delivered, cancelled]
                  example: shipped
              required:
                - status
            example:
              status: shipped
      responses:
        '200':
          description: Order updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Invalid input
        '404':
          description: Order not found
    delete:
      summary: Delete an order (Admin only)
      tags:
        - Orders
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the order to delete
          example: order_001
      responses:
        '204':
          description: Order deleted successfully
        '404':
          description: Order not found
