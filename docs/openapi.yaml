openapi: 3.1.0
info:
  title: Celeste API
  description: API documentation for the Celeste e-commerce platform.
  version: 1.0.0
servers:
  - url: http://localhost:3000
    description: Local Development Server
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          example: user_123
        name:
          type: string
          example: 'John Doe'
        email:
          type: string
          example: 'john.doe@example.com'
        phone:
          type: string
          example: '+15551234567'
        address:
          type: string
          example: '123 Main St, Anytown, USA'
        isDelivery:
          type: boolean
          example: false
        role:
          type: string
          enum: [CUSTOMER, ADMIN]
          example: 'CUSTOMER'
        createdAt:
          type: string
          format: date-time
          example: '2024-07-25T10:00:00Z'
        wishlist:
          type: array
          items:
            type: string
          example: ['prod_123', 'prod_456']
        cart:
          type: array
          items:
            $ref: '#/components/schemas/CartItem'
    CartItem:
      type: object
      properties:
        productId:
          type: string
          example: prod_123
        quantity:
          type: number
          format: integer
          example: 1
        addedAt:
          type: string
          format: date-time
          example: '2024-07-25T10:00:00Z'
    CreateUser:
      type: object
      properties:
        name:
          type: string
          example: 'John Doe'
        email:
          type: string
          example: 'john.doe@example.com'
        phone:
          type: string
          example: '+15551234567'
        address:
          type: string
          example: '123 Main St, Anytown, USA'
        isDelivery:
          type: boolean
          example: false
        role:
          type: string
          enum: [CUSTOMER, ADMIN]
          example: 'CUSTOMER'
    UpdateUser:
      type: object
      properties:
        name:
          type: string
          example: 'John Doe'
        email:
          type: string
          example: 'john.doe@example.com'
        phone:
          type: string
          example: '+15551234567'
        address:
          type: string
          example: '123 Main St, Anytown, USA'
        isDelivery:
          type: boolean
          example: false
    AddToWishlist:
      type: object
      properties:
        productId:
          type: string
          example: 'prod_123'
    AddToCart:
      type: object
      properties:
        productId:
          type: string
          example: 'prod_123'
        quantity:
          type: number
          format: integer
          example: 1
    UpdateCartItem:
      type: object
      properties:
        quantity:
          type: number
          format: integer
          example: 2
    Auth:
      type: object
      properties:
        accessToken:
          type: string
          description: JWT access token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
    UserRegistration:
      type: object
      required:
        - idToken
        - name
      properties:
        idToken:
          type: string
          example: "eyJhbGciOiJSUzI1NiIsImtpZCI6IjkyZTg4M2..."
        name:
          type: string
          example: "John Doe"
    Product:
      type: object
      properties:
        id:
          type: string
          example: prod_123
        name:
          type: string
          example: 'Wireless Bluetooth Headphones'
        description:
          type: string
          example: 'High-quality over-ear headphones with noise cancellation.'
        price:
          type: number
          format: float
          example: 99.99
        unit:
          type: string
          example: 'piece'
        categoryId:
          type: string
          example: 'cat_456'
        imageUrl:
          type: string
          example: 'https://example.com/headphones.jpg'
    Category:
      type: object
      properties:
        id:
          type: string
          example: cat_456
        name:
          type: string
          example: 'Electronics'
        description:
          type: string
          example: 'Devices and gadgets for modern living.'
        imageUrl:
          type: string
          example: 'https://example.com/electronics.jpg'
        parentCategoryId:
          type: string
          nullable: true
          example: null
    Discount:
      type: object
      properties:
        id:
          type: string
          example: disc_789
        name:
          type: string
          example: 'Summer Sale'
        description:
          type: string
          example: '20% off all electronics.'
        type:
          type: string
          enum: [PERCENTAGE, FLAT]
          example: PERCENTAGE
        value:
          type: number
          format: float
          example: 20
        validFrom:
          type: string
          format: date-time
          example: '2024-06-01T00:00:00Z'
        validTo:
          type: string
          format: date-time
          example: '2024-08-31T23:59:59Z'
        applicableProducts:
          type: array
          items:
            type: string
          example: ['prod_123', 'prod_456']
        applicableCategories:
          type: array
          items:
            type: string
          example: ['cat_456']
    Store:
      type: object
      properties:
        id:
          type: string
          example: store_123
        name:
          type: string
          example: 'Main Street Store'
        description:
          type: string
          example: 'Our flagship store.'
        address:
          type: string
          example: '123 Main St, Anytown, USA'
        phone:
          type: string
          example: '+15551234567'
        email:
          type: string
          example: 'main@example.com'
        location:
          type: object
          properties:
            latitude:
              type: number
              example: 34.0522
            longitude:
              type: number
              example: -118.2437
        isActive:
          type: boolean
          example: true
security:
  - bearerAuth: []
paths:
  /auth/register:
    post:
      summary: Register a new user
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegistration'
            example:
              idToken: "eyJhbGciOiJSUzI1NiIsImtpZCI6IjkyZTg4M2..."
              name: "Jane Doe"
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Auth'
        '400':
          description: Invalid input
  /products:
    get:
      summary: Get all products
      tags:
        - Products
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
          description: Limit the number of products returned
        - in: query
          name: offset
          schema:
            type: integer
          description: Offset for pagination
        - in: query
          name: includeDiscounts
          schema:
            type: boolean
          description: Include discounts for each product
      responses:
        '200':
          description: A list of products
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'
    post:
      summary: Create a new product
      tags:
        - Products
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Product'
      responses:
        '201':
          description: Product created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
  /products/{id}:
    get:
      summary: Get a product by ID
      tags:
        - Products
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the product to retrieve
        - in: query
          name: includeDiscounts
          schema:
            type: boolean
          description: Include discounts for the product
      responses:
        '200':
          description: Product details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '404':
          description: Product not found
    put:
      summary: Update a product
      tags:
        - Products
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the product to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Product'
      responses:
        '200':
          description: Product updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '404':
          description: Product not found
    delete:
      summary: Delete a product
      tags:
        - Products
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the product to delete
      responses:
        '204':
          description: Product deleted successfully
        '404':
          description: Product not found
  /categories:
    get:
      summary: Get all categories
      tags:
        - Categories
      responses:
        '200':
          description: A list of categories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'
    post:
      summary: Create a new category
      tags:
        - Categories
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Category'
      responses:
        '201':
          description: Category created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
  /categories/{id}:
    get:
      summary: Get a category by ID
      tags:
        - Categories
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the category to retrieve
      responses:
        '200':
          description: Category details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '404':
          description: Category not found
    put:
      summary: Update a category
      tags:
        - Categories
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the category to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Category'
      responses:
        '200':
          description: Category updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '404':
          description: Category not found
    delete:
      summary: Delete a category
      tags:
        - Categories
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the category to delete
      responses:
        '204':
          description: Category deleted successfully
        '404':
          description: Category not found
  /discounts:
    get:
      summary: Get all discounts
      tags:
        - Discounts
      parameters:
        - in: query
          name: availableOnly
          schema:
            type: boolean
          description: Filter for currently available discounts
        - in: query
          name: populateReferences
          schema:
            type: boolean
          description: Populate product and category references
      responses:
        '200':
          description: A list of discounts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Discount'
    post:
      summary: Create a new discount
      tags:
        - Discounts
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Discount'
      responses:
        '201':
          description: Discount created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Discount'
  /discounts/{id}:
    get:
      summary: Get a discount by ID
      tags:
        - Discounts
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the discount to retrieve
      responses:
        '200':
          description: Discount details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Discount'
        '404':
          description: Discount not found
    put:
      summary: Update a discount
      tags:
        - Discounts
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the discount to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Discount'
      responses:
        '200':
          description: Discount updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Discount'
        '404':
          description: Discount not found
    delete:
      summary: Delete a discount
      tags:
        - Discounts
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the discount to delete
      responses:
        '204':
          description: Discount deleted successfully
        '404':
          description: Discount not found
  /users/{id}:
    get:
      summary: Get user profile
      tags:
        - Users
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the user to retrieve
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: User not found
    put:
      summary: Update user profile
      tags:
        - Users
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the user to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUser'
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: User not found
    delete:
      summary: Delete a user
      tags:
        - Users
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the user to delete
      responses:
        '204':
          description: User deleted successfully
        '404':
          description: User not found
  /users:
    post:
      summary: Create a new user
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUser'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
  /users/{id}/wishlist:
    post:
      summary: Add a product to the user's wishlist
      tags:
        - Users
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddToWishlist'
      responses:
        '200':
          description: Product added to wishlist
        '404':
          description: User not found
  /users/{id}/wishlist/{productId}:
    delete:
      summary: Remove a product from the user's wishlist
      tags:
        - Users
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the user
        - in: path
          name: productId
          required: true
          schema:
            type: string
          description: ID of the product to remove from the wishlist
      responses:
        '200':
          description: Product removed from wishlist
        '404':
          description: User or product not found
  /users/{id}/cart:
    post:
      summary: Add an item to the user's cart
      tags:
        - Users
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddToCart'
      responses:
        '200':
          description: Item added to cart
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CartItem'
        '404':
          description: User not found
  /users/{id}/cart/{productId}:
    put:
      summary: Update an item in the user's cart
      tags:
        - Users
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the user
        - in: path
          name: productId
          required: true
          schema:
            type: string
          description: ID of the product to update in the cart
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCartItem'
      responses:
        '200':
          description: Cart item updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CartItem'
        '404':
          description: User or product not found
    delete:
      summary: Remove an item from the user's cart
      tags:
        - Users
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the user
        - in: path
          name: productId
          required: true
          schema:
            type: string
          description: ID of the product to remove from the cart
      responses:
        '200':
          description: Item removed from cart
        '404':
          description: User or product not found
  /stores:
    get:
      summary: Get all stores
      tags:
        - Stores
      responses:
        '200':
          description: A list of stores
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Store'
  /stores/{id}:
    get:
      summary: Get a store by ID
      tags:
        - Stores
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the store to retrieve
      responses:
        '200':
          description: Store details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Store'
        '404':
          description: Store not found
  /stores/nearby:
    get:
      summary: Get nearby stores
      tags:
        - Stores
      parameters:
        - in: query
          name: latitude
          required: true
          schema:
            type: number
          description: Latitude for the search
        - in: query
          name: longitude
          required: true
          schema:
            type: number
          description: Longitude for the search
        - in: query
          name: radius
          schema:
            type: number
          description: Radius for the search in kilometers
        - in: query
          name: limit
          schema:
            type: number
          description: Limit the number of stores returned
      responses:
        '200':
          description: A list of nearby stores
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Store'